@model SG2.CORE.MODAL.ViewModals.Backend.DashBoard.DashboardViewModel
@{
    ViewBag.Title = "Dashboard";
    Layout = "~/Areas/SuperAdmin/Views/Shared/_LayoutNew.cshtml";
    var BaseURl = ViewBag.BaseUrl;
}

<div class="main">
    <div class="container">
        <div class="row">
            <div class="col-xs-12">
                <h2>Dashboard</h2>
            </div>
        </div>
    </div>
</div>



<div class="form-wrap">
    <div class="container">
        <div class="information-form-inner">
            <div class="row">

                <div class="col-xs-12">

                    @*@foreach (var item in Model.dashboardListingModel.OrderBy(x=>x.JVBoxId))
                        {

                            <div class="col-md-3">
                                @item.BoxName
                            </div>
                            <div class="col-md-3">


                                    <label class="form-radio">
                                        Running
                                        @Html.RadioButtonFor(model => item.ServerRunningStatusId, "1",new  { @Name = item.JVBoxId,MP_Id=item.JVBoxId,@class="MPServerrunning"})
                                        <span class="checkmark"></span>
                                    </label>
                                    <label class="form-radio">
                                        Stopped
                                        @Html.RadioButtonFor(model => item.ServerRunningStatusId, "2", new { @Name  = item.JVBoxId, MP_Id = item.JVBoxId, @class = "MPServerrunning" })
                                        <span class="checkmark"></span>
                                    </label>
                                </div>


                        }*@



                </div>

            </div>

            <div class="row">
                <div class="col-md-12">
                    <div class="panel panel-primary">
                        <div class="panel-heading">
                            <h3 class="panel-title">Notifications</h3>

                            <span class="pull-right clickable panel-collapsed">
                                <i class="glyphicon glyphicon-chevron-down"></i>
                            </span>
                            <span class="pull-right btn_refreshJVSection" data-id="botmngr">
                                <i class="glyphicon glyphicon-refresh"></i>
                            </span>

                            @*<span class="pull-right">Read | <b id="totalR"></b></span>
                                <span class="pull-right">UnRead | <b id="totalUR"></b></span>*@
                        </div>

                        <div class="panel-body">
                            <table class="table table-bordered table-striped table-hover table-condensed">
                                <thead>
                                    <tr>
                                        <th scope="col">Date</th>
                                      
                                        <th scope="col">Notification</th>
                                        <th scope="col">Social Username</th>
                                        <th scope="col">Status</th>
                                        <th scope="col">Action</th>
                                    </tr>
                                </thead>
                                <tbody style="max-height:10px;min-height: 10px;overflow-y: scroll;" id="TR_JVCustomersHTM" class="TR_JVCustomersHTM"></tbody>
                            </table>
                        </div>

                    </div>
                </div>
            </div>

            <!-- Html just for entering data -->
            <table class="hidden mgr_innerHTML">
                <tr>
                    <td>{{Date}}</td>
                   
                    <td>{{Notification}}</td>
                    <td>{{SocialUserName}}</td>
                    <td>{{Status}}</td>
                    <td>
                        <a title="Read" href="#" class="btn_NotificationRead" data-id="{{Id}}"><i class="fa fa-eye"></i></a>
                        <a title="Close" href="#" class="btn_NotificationClose" data-id="{{Id}}"><i class="fa fa-trash"></i></a>

                    </td>
                </tr>
            </table>

            <hr />

            <div class="row">
                <div class="col-sm-12">
                    <h1>Reports</h1>
                    <hr />
                </div>
                <div class="col-md-6 col-sm-12 reportsDiv">
                    <h1> Most Popular Product ( last three months ) </h1>
                    <br />
                    <div id="MostPopularProductPiChart" style="width:100%; height:400px; align-content:center;"></div>
                </div>
                <div class="col-md-12 col-sm-12 reportsDiv">
                    <h1> Profile Trends</h1>
                    <br />
                    <div id="profileActions" style="width:100%; height:400px; align-content:center;"></div>
                </div>



            </div>

        </div>
    </div>
</div>

@section scripts{

    <script src="~/Scripts/ECharts/echarts.js"></script>
    <script src="~/Scripts/ECharts/echarts-all.js"></script>
    <script src="~/Scripts/ECharts/chart/bar.js"></script>
    <script src="~/Scripts/ECharts/chart/line.js"></script>
    <script src="~/Scripts/ECharts/chart/chord.js"></script>
    <script src="~/Scripts/ECharts/chart/eventRiver.js"></script>
    <script src="~/Scripts/ECharts/chart/force.js"></script>
    <script src="~/Scripts/ECharts/chart/funnel.js"></script>
    <script src="~/Scripts/ECharts/chart/gauge.js"></script>
    <script src="~/Scripts/ECharts/chart/k.js"></script>
    <script src="~/Scripts/ECharts/chart/map.js"></script>
    <script src="~/Scripts/ECharts/chart/pie.js"></script>
    <script src="~/Scripts/ECharts/chart/radar.js"></script>
    <script src="~/Scripts/ECharts/chart/scatter.js"></script>
    <script src="~/Scripts/ECharts/chart/tree.js"></script>
    <script src="~/Scripts/ECharts/chart/treemap.js"></script>
    <script src="~/Scripts/ECharts/chart/venn.js"></script>
    <script src="~/Scripts/ECharts/chart/wordCloud.js"></script>
    <script src="~/Scripts/ECharts/chart/echarts-all-english-v2.js"></script>
    <script type="text/javascript">

        $("document").ready(function () {

            $(document).on('click', '.panel-heading span.clickable', function (e) {
                var $this = $(this);
                if (!$this.hasClass('panel-collapsed')) {
                    $this.parents('.panel').find('.panel-body').slideUp();
                    $this.addClass('panel-collapsed');
                    $this.find('i').removeClass('glyphicon-chevron-up').addClass('glyphicon-chevron-down');
                } else {
                    $this.parents('.panel').find('.panel-body').slideDown();
                    $this.removeClass('panel-collapsed');
                    $this.find('i').removeClass('glyphicon-chevron-down').addClass('glyphicon-chevron-up');
                }
            })


            setInterval(function () {
                LoadNotificationData();
            }, 60 * 1000);

            $(".btn_refreshJVSection").on("click", function (e) {

                LoadNotificationData();
            })

            $(".MPServerrunning").on("change", function (e) {

                var JvBoxid = $(this).attr("MP-Id");
              var RValue=  $(this).val();

                $.ajax({

                    url: GLB_BASEURL + "/Dashboard/JVBoxSetServerRunningStatus",
                    type: "Get",
                    data: { jvboxid: JvBoxid, serverrunningstatusId: RValue },
                    dataType: "json",
                    contentType: "application/json; charset=utf-8",
                    success: function (Data) {


                    },
                    error: function () {
                        alert("An error has occured!!!");
                    }
                });

            })

            LoadNotificationData();
            function LoadNotificationData() {
                var NotificationHtml = "#TR_JVCustomersHTM";
                var glb_TR_JVCustomersHTML = $(".mgr_innerHTML tbody").html();
                $(NotificationHtml).html("");
                var url = GLB_BASEURL + "/Dashboard/GetNotificationData/" + 1;
                $(NotificationHtml).html('<tr><td colspan="5" class="loadingSpinner"><i class="fa fa-refresh fa-spin spiner"></i></td></tr>');
                $.ajax({
                    url: url,
                    global: false,
                    type: 'get',
                    contentType: "application/json",
                    async: true,
                    success: function (result) {
                        if (!$.isEmptyObject(result)) {
                            if (result.Data.ResultType == "Success") {
                                $(NotificationHtml).html("");
                                $.each(result.Data.ResultData, function (i, obj) {
                                    var tr = glb_TR_JVCustomersHTML
                                        .replace("{{Date}}", getFormatedDateTime(obj.CreatedOn))
                                        .replace("{{Mode}}", obj.Mode)
                                        .replace("{{Notification}}", obj.Notification)
                                        .replace("{{SocialUserName}}", obj.SocialUsername)
                                        .replace("{{Status}}", obj.StatusName)
                                        .replace("{{Id}}", obj.Id)
                                        .replace("{{Id}}", obj.Id)
                                    $(NotificationHtml).append(tr);
                                    //$('#totalE-' + jvServer).text(obj.TotalError)
                                    //$('#totalIP-' + jvServer).text(obj.TotalInProgress)
                                    //$('#totalP-' + jvServer).text(obj.TotalPending)

                                });

                                BindNotificationClickEvent();
                            }
                            else {
                                $(NotificationHtml).html("");
                            }
                        }
                    },
                    error: function () {
                        $(NotificationHtml).html("");
                    }
                });
            }


            function BindNotificationClickEvent() {
                $(".btn_NotificationRead").unbind();
                $(".btn_NotificationRead").bind("click", NotificationRead);

                $(".btn_NotificationClose").unbind();
                $(".btn_NotificationClose").bind("click", NotificationClose);
            }

            function NotificationRead(e) {
                e.preventDefault();
                e.stopPropagation();

                var id = $(this).attr("data-id");

                $.ajax({

                    url: GLB_BASEURL + "/Dashboard/ReadNotification",
                    type: "Get",
                    data: { id: id, statusId:52},
                    dataType: "json",
                    contentType: "application/json; charset=utf-8",
                    success: function (Data) {

                        if (Data.Data.ResultType == "Success") {
                            LoadNotificationData();
                        } else {

                        }
                    },
                    error: function () {
                        alert("An error has occured!!!");
                    }
                });
            }


        function NotificationClose(e) {
            e.preventDefault();
            e.stopPropagation();
            var id = $(this).attr("data-id");
                $.ajax({

                    url: GLB_BASEURL + "/Dashboard/ReadNotification",
                    type: "Get",
                    data: { id: id, statusId: 53 },
                    dataType: "json",
                    contentType: "application/json; charset=utf-8",
                    success: function (Data) {

                        if (Data.Data.ResultType == "Success") {
                            LoadNotificationData();
                        } else {

                        }
                    },
                    error: function () {
                        alert("An error has occured!!!");
                    }
                });
            }


            $.ajax({
                type: "GET",
                url: "/Dashboard/GetAdminReports",
                dataType: "json",
                success: function (Response) {


                    if (!$.isEmptyObject(Response)) {
                        if (Response.Data.ResultType == "Success") {

                            //LoadJVServersPiChart(Response.Data.ResultData);

                            LoadTMostPopularProductPiChartPiChart(Response.Data.ResultData);

                            LoadAccountTrends(document.getElementById('profileActions'),Response.Data.EventsData);
                            //LoadTotalUsedIPsPiChart(Response.Data.ResultData);
                        } else {

                        }
                    }
                },
                failure: function (errMsg) {
                    alert("hello2");

                }
            });

        });


        function LoadJVServersPiChart(ChartsData) {


            var dom = document.getElementById("JVServersPiChart");
            var myChart = echarts.init(dom);
            var app = {};
            option = null;
            option = {
                title: {
                    text: '',
                    subtext: '',
                    x: 'center'
                },
                tooltip: {
                    trigger: 'item',
                    formatter: "{a} <br/>{b} : {c} ({d}%)"
                },
                legend: {
                    orient: 'horizontal',
                    left: 'left',
                    data: ['All Slots', 'Used Slots','Free Slots']
                },
                series: [
                    {
                        name: 'MP Box',
                        type: 'pie',
                        radius: '45%',
                        center: ['50%', '60%'],
                        data: [

                            { value: ChartsData.AllSlotsOnJVBox, name: 'All Slots' },
                            { value: ChartsData.UsedSlotsOnJVBox, name: 'Used Slots' },
                            { value: ChartsData.FreeSlotsOnJVServer, name: 'Free Slots' }
                        ],
                        itemStyle: {
                            emphasis: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            }
                        }
                    }
                ]
            };
            ;
            if (option && typeof option === "object") {
                myChart.setOption(option, true);
            }
        }

        function LoadTMostPopularProductPiChartPiChartx(ChartsData) {


            ;

            var nameList = [
                ChartsData.PlanNames.split(',')
            ];

            var dom = document.getElementById("MostPopularProductPiChart");
            var myChart = echarts.init(dom);
            var app = {};
            option = null;
            var data = genData(50, nameList);

            option = {
                title: {
                    text: '',
                    subtext: '',
                    x: 'center'
                },
                tooltip: {
                    trigger: 'item',
                    formatter: "{a} <br/>{b} : {c} ({d}%)"
                },
                legend: {
                    type: 'scroll',
                    orient: 'vertical',
                    right: 10,
                    top: 20,
                    bottom: 20,
                    data: data.legendData,

                    selected: data.selected
                },
                series: [
                    {
                        name: 'Product',
                        type: 'pie',
                        radius: '55%',
                        center: ['40%', '50%'],
                        data: data.seriesData,
                        itemStyle: {
                            emphasis: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            }
                        }
                    }
                ]
            };




            function genData(count, nameList) {
                ;
                var legendData = [];
                var seriesData = [];
                var selected = {};
                for (var i = 0; i < 50; i++) {
                    name = Math.random() > 0.65
                        ? makeWord(4, 1) + '·' + makeWord(3, 0)
                        : makeWord(2, 1);
                    legendData.push(name);
                    seriesData.push({
                        name: name,
                        value: Math.round(Math.random() * 100000)
                    });
                    selected[name] = i < 6;
                }

                return {
                    legendData: legendData,
                    seriesData: seriesData,
                    selected: selected
                };

                function makeWord(max, min) {
                    var nameLen = Math.ceil(Math.random() * max + min);
                    var name = [];
                    for (var i = 0; i < nameLen; i++) {
                        name.push(nameList[Math.round(Math.random() * nameList.length - 1)]);
                    }
                    return name.join('');
                }
            }
            ;
            if (option && typeof option === "object") {
                myChart.setOption(option, true);
            }
        }

        function getFormatedDateTime(getDate) {
            var current_datetime = new Date(parseInt(getDate.substr(6)));
            var dt = current_datetime.getFullYear() + "-" + (current_datetime.getMonth() + 1) + "-" + current_datetime.getDate() + " " + current_datetime.getHours() + ":" + current_datetime.getMinutes() + ":" + current_datetime.getSeconds();
            return dt;
        }


        function LoadTMostPopularProductPiChartPiChart(ChartsData) {

            var nameList =
                ChartsData.PlanNames;

            var dom = document.getElementById("MostPopularProductPiChart");
            var myChart = echarts.init(dom);
            var app = {};
            option = null;
            option = {
                title: {
                    text: '',
                    subtext: '',
                    x: 'left',
                },
                tooltip: {
                    trigger: 'item',
                    formatter: "{a} <br/>{b} : {c} ({d}%)"
                },
                legend: {
                    orient: 'horizontal',
                    left: 'left',
                    data: ChartsData.PlanNames
                },
                series: [
                    {
                        name: 'MP Box',
                        type: 'pie',
                        radius: '45%',
                        center: ['50%', '60%'],
                        data: ChartsData.PlanNamesWithUsages,
                            //[{ name: "LikeX1K", value: 3 }, { name: "LikeX2K", value: 2 }, { name: "LikeX300", value: 1 }, { name: "LikeX500", value: 3 }, { name: "LikeX750", value: 1 }, { name: "No Boost", value: 8 }],
                        labelLine: {
                            normal: {
                                show: true

                            }
                        },
                        itemStyle: {
                            emphasis: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            }
                        },
                        lable:
                        {
                            show: true,
                            position: 'inside'
                        }
                    }
                ]
            };
            ;
            if (option && typeof option === "object") {
                myChart.setOption(option, true);
            }
        }

        function LoadTotalUsedIPsPiChart(ChartsData) {


            var dom = document.getElementById("TotalUsedIPsPiChart");
            var myChart = echarts.init(dom);
            var app = {};
            option = null;
            option = {
                title: {
                    text: '',
                    subtext: '',
                    x: 'center'
                },
                tooltip: {
                    trigger: 'item',
                    formatter: "{a} <br/>{b} : {c} ({d}%)"
                },
                legend: {
                    orient: 'horizontal',
                   // left: 'left',
                    right:'right',
                    data: ['All Proxy IPs', 'Used Proxy IPs', 'Remaining Proxy IPs',]
                },
                series: [
                    {
                        name: 'Proxy IPs',
                        type: 'pie',
                        radius: '45%',
                        center: ['50%', '60%'],
                        data: [
                            { value: ChartsData.AllAvailableIPs, name: 'All Proxy IPs' },
                            { value: ChartsData.TotalUsedIPs, name: 'Used Proxy IPs' },
                            { value: ChartsData.RemainingProxyIPs, name: 'Remaining Proxy IPs' }


                        ],
                        itemStyle: {
                            emphasis: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            }
                        }
                    }
                ]
            };
            ;
            if (option && typeof option === "object") {
                myChart.setOption(option, true);
            }
        }

        function LoadAccountTrends(elem,ChartsData) {
            //var dom = document.getElementById("JVServersPiChart");
            var myChart = echarts.init(elem);
            option = {
                title: {
                    text: '折线图堆叠'
                },
                tooltip: {
                    trigger: 'axis'
                },
                legend: {
                    data: ['邮件营销', '联盟广告', '视频广告', '直接访问', '搜索引擎']
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                toolbox: {
                    feature: {
                        saveAsImage: {}
                    }
                },
                xAxis: {
                    type: 'category',
                    boundaryGap: false,
                    data: ['周一', '周二', '周三', '周四', '周五', '周六', '周日']
                },
                yAxis: {
                    type: 'value'
                },
                series: [
                    {
                        name: '邮件营销',
                        type: 'line',
                        stack: '总量',
                        data: [120, 132, 101, 134, 90, 230, 210]
                    },
                    {
                        name: '联盟广告',
                        type: 'line',
                        stack: '总量',
                        data: [220, 182, 191, 234, 290, 330, 310]
                    },
                    {
                        name: '视频广告',
                        type: 'line',
                        stack: '总量',
                        data: [150, 232, 201, 154, 190, 330, 410]
                    },
                    {
                        name: '直接访问',
                        type: 'line',
                        stack: '总量',
                        data: [320, 332, 301, 334, 390, 330, 320]
                    },
                    {
                        name: '搜索引擎',
                        type: 'line',
                        stack: '总量',
                        data: [820, 932, 901, 934, 1290, 1330, 1320]
                    }
                ]
            };
            if (option && typeof option === "object") {
                myChart.setOption(option, true);
            }

        }
    </script>
}

<style type="text/css">
    .reportsDiv {
        text-align: center
    }

        .reportsDiv h1 {
            font-size: 22pt;
            border-bottom: 2px solid #ff652f;
            display: inline-block;
            line-height: 40pt;
            margin-bottom: 18pt;
        }

    .clickable {
        cursor: pointer;
    }

    .panel-heading span {
        margin-top: -20px;
        font-size: 15px;
        margin-left: 15px;
    }

    .btn_refreshJVSection {
        cursor: pointer
    }

    .loadingSpinner {
        text-align: center;
        padding: 25px 0;
        font-size: 25pt;
        color: yellowgreen;
    }

    #Modal_BotDetail .modal-body {
        position: relative;
        padding: 15px;
        height: 360px;
        overflow-y: scroll;
    }
    .main {
    padding-top: 46px;
}

</style>
